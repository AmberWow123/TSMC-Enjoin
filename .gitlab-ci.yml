# This file is a template, and might need editing before it works on your project.
# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/ee/development/cicd/templates.html
# This specific template is located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Python.gitlab-ci.yml

# Official language image. Look for the different tagged releases at:
# https://hub.docker.com/r/library/python/tags/
image: python:3.7
before_script:
    - python -V  # Print out python version for debugging
    - apt-get update -qy
    - apt-get install -y python-dev python-pip
    - pip install -r requirements.txt

app:
    script:
        - pip install -r requirements.txt
        - export MONGODB_URL=$MONGODB_URL
 
production:
    type: deploy
    image: python:3.7
    script:
        - apt-get update -qy
        - apt-get install -y ruby-dev
        - gem install dpl
        - python -V  # Print out python version for debugging
        - dpl --provider=heroku --app=$HEROKU_APP_PRODUCTION --api-key=$HEROKU_SECRET_KEY
        - export MONGODB_URL=$MONGODB_URL
        - pip install -r requirements.txt
    only:
        - master
